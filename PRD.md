# PRD (Product Requirements Document) - 建物耐用年数 判定・計算アプリ (Agentアーキテクチャ版)

## 1. 目的・ゴール

*   **目的:**
    *   建物の構造や用途に関する段階的な質問に答えることで法定耐用年数を簡易的に判定し、さらにその法定耐用年数と購入情報等を用いて中古資産の耐用年数を計算する、モジュール化されたWebアプリケーションを提供する。
    *   アプリケーションを複数の独立した責務を持つ「Agent」（機能モジュール群）で構成し、将来的な機能追加や変更に対する柔軟性と拡張性を確保する。
*   **ゴール:**
    *   利用者が法定耐用年数を迅速かつ容易に特定できるようにする。
    *   中古資産の耐用年数計算プロセスを簡略化し、適用される計算方法と結果を明確に提示する。
    *   計算根拠を明示することで、利用者の理解を助け、透明性を高める。
    *   不動産関連業務や経理業務における耐用年数参照・計算の初期段階をサポートする。
    *   Agentベースのアーキテクチャにより、各機能の独立性を高め、保守性とテスト容易性を向上させる。
    *   将来的に新しい計算ロジックや関連機能をAgentとして容易に追加できる基盤を構築する。

## 2. ターゲットユーザー

*   税理士、会計士、不動産鑑定士、ファイナンシャルプランナー（FP）などの専門家。
*   企業の経理担当者、固定資産管理担当者。
*   不動産投資家、アパート・マンション経営者、個人事業主。
*   不動産や税法について学習している学生や実務家。

## 3. 主要機能 (Agent責務と共に)

*   **RootAgent (Orchestrator):** アプリケーション全体のライフサイクル管理、グローバルUIのレンダリング、各機能Agentの協調動作の制御。
    *   **F0.1: メインレイアウト提供:** ヘッダー、フッター、Agentがコンテンツを表示するメインエリアの提供。
    *   **F0.2: グローバル状態管理 (一部):** Agent間で共有が必要な最小限の状態（例：現在のテーマ、法定耐用年数の検索結果など）の管理。
    *   **F0.3: Agent間連携・指示:** 必要に応じてAgent間のイベントやデータフローを仲介し、各Agentの動作を指示する。

*   **F1: 法定耐用年数検索機能 (担当: StatutoryLifespanAgent)**
    *   ユーザーは以下の項目について、段階的に選択肢を選んでいく。
        1.  **構造・用途** (例: 木造・合成樹脂造のもの, 金属造のもの)
        2.  **細目** (例: 事務所用のもの, 店舗用・住宅用のもの)
        3.  **骨格材の肉厚** (例: ４㎜を超えるもの, ３㎜以下のもの)
    *   各ステップの選択肢は、前のステップの選択に基づいて動的にフィルタリングされる。
    *   「骨格材の肉厚」の選択肢は、「構造・用途」で「金属造のもの」が選択された場合のみ表示され、選択可能となる。
    *   前のステップが未選択の場合、次のステップのドロップダウンは非活性化される。
    *   すべての必須項目が選択されると、該当する「法定耐用年数」が結果エリアに表示される。この結果は`UsedAssetCalculatorAgent`に通知される。

*   **F2: 中古資産耐用年数計算機能 (担当: UsedAssetCalculatorAgent)**
    *   **入力フォーム:**
        *   購入価額 (数値入力、必須)
        *   うち改良に要した金額 (数値入力、任意)
        *   経過年月 (年と月の入力、必須)
        *   法定耐用年数 (数値入力、必須。`StatutoryLifespanAgent`からの結果が自動入力されるが、編集可能)
        *   再取得価額 (数値入力、任意。ただし特定の計算ロジックで使用)
    *   **計算実行:** 「計算」ボタンクリックで実行。
    *   **結果表示:**
        *   適用された計算方法の名称 (例: 簡便法、見積法、法定耐用年数)
        *   計算された中古資産の耐用年数 (年単位。1年未満の端数は切り捨て。ただし計算結果が2年未満の場合は2年とする)
    *   **計算根拠表示:**
        *   適用された計算方法の計算式と、入力された値がどのように使用されたかを具体的に表示する。
        *   どの条件に基づいて計算方法が選択されたかの判定ロジックも表示する。

*   **F3: 計算ロジック補助情報表示 (担当: UIDisplayAgent または UsedAssetCalculatorAgent の一部)**
    *   中古資産の耐用年数計算における主要な計算方法（簡便法、見積法、法定耐用年数を使用するケース）の概要と、適用条件の判定基準を表形式などで分かりやすく画面下部などに表示する。
    *   この情報は、必要に応じて表示/非表示を切り替えられるようにする（トグルボタンなど）。

*   **F4: クリア（リセット）機能 (担当: RootAgent が各Agentに指示)**
    *   「クリア」または「リセット」ボタンをクリックすると、全Agentの管理する選択項目、入力項目、表示結果がすべてリセットされ、初期状態に戻る。

*   **DataManagementAgent (内部Agent):**
    *   **D1: 法定耐用年数データ管理:** `BuildingLifespan(UTF8).csv`相当のデータを管理し、`StatutoryLifespanAgent`に提供。
    *   **D2: 中古資産耐用年数計算ロジック管理:** 計算式、判定ロジックを保持し、`UsedAssetCalculatorAgent`に提供。
    *   計算には、ユーザーが入力した「法定耐用年数（originalUsefulLife）」および「経過年数（elapsedYears）」が必ず利用される。

## 4. データ要件

*   **D1: 法定耐用年数データ:** (`DataManagementAgent`が管理)
    *   建物の「構造・用途」「細目」「骨格材の肉厚」の組み合わせと、それに対応する「耐用年数」を含むマスターデータ。アプリケーション内で静的に保持。
*   **D2: 中古資産耐用年数計算ロジック:** (`DataManagementAgent`が管理)
    *   国税庁の指針に基づいた中古資産の耐用年数計算式および適用条件の判定ロジック。アプリケーション内にロジックとして組み込まれる。
    *   計算には、ユーザーが入力した「法定耐用年数（originalUsefulLife）」および「経過年数（elapsedYears）」が必ず利用される。
*   **D3: Agent間データ連携:**
    *   `StatutoryLifespanAgent`で決定された法定耐用年数は、`UsedAssetCalculatorAgent`の入力フィールドに連携される。
    *   状態管理ライブラリ (例: Zustand, Jotai) または React Context API を通じて、Agent間で必要な最小限のデータを共有・通知する。

## 5. UI/UX要件 (2024/2025年トレンドとBest Practiceを反映)

*   **UI1: モダンでクリーンなインターフェース:**
    *   **ミニマリズム:** 十分な余白、明確な視覚階層、不要な装飾の排除。
    *   **タイポグラフィ:** 高い可読性と美観を両立するフォントシステム（例: `Inter`, `Noto Sans JP`）。適切なフォントサイズ、ウェイト、行間。
    *   **配色:** ベースカラー、アクセントカラーを明確にし、コントラスト比に配慮 (WCAG 2.1 AA準拠)。
    *   **ダークモード対応:** OSの設定に追従、または手動切り替え可能なダークモードを提供する。
*   **UI2: 直感的な操作性:**
    *   各選択肢・入力フィールドのラベルを明確に表示し、必須項目にはアスタリスク(*)や「必須」ラベルで明示。
    *   入力フィールドは適切なサイズとプレースホルダーテキストで入力を補助。
    *   数値入力は可能であればスピナーやスライダーも検討（ただし煩雑にならない範囲で）。
*   **UI3: インタラクティブなフィードバック:**
    *   **マイクロインタラクション:** ボタンホバー時のエフェクト、ドロップダウン開閉時のスムーズなアニメーション、選択状態の明確な視覚化。
    *   ローディングや計算処理中には、適切なインジケーター（例: スピナー、プログレスバー）を表示。
    *   入力エラー（例: 非数値入力、必須項目未入力）は、該当フィールドの近くにリアルタイムかつ分かりやすいメッセージで提示。
*   **UI4: プログレッシブ・ディスクロージャー:**
    *   法定耐用年数検索(F1)は段階的フィルタリングを維持し、ユーザーが必要な情報に集中できるようにする。
    *   計算根拠(F2)や補助情報(F3)は、デフォルトで簡潔に表示し、詳細表示はユーザーのアクション（クリック、トグル）に応じて開閉できるようにする。
*   **UI5: 結果表示の明確性:**
    *   法定耐用年数、中古資産耐用年数の計算結果は、他の情報と区別しやすいスタイル（例: 大きめのフォント、強調色）で表示。
    *   計算根拠は構造化され、論理的な流れが理解しやすいようにレイアウトする。
*   **UX1: スムーズなフロー:**
    *   F1からF2への法定耐用年数の自動入力はシームレスに行う。
    *   クリアボタンは、常にアクセスしやすい固定位置（例: 画面右上、フォーム下部）に配置。
*   **UX2: アクセシビリティ (A11y):**
    *   WCAG 2.1 レベルAA準拠を目指す。
    *   全てのインタラクティブ要素はキーボードのみで操作可能にする。
    *   適切なARIA属性を使用し、スクリーンリーダー利用者に情報が正確に伝わるようにする。
    *   フォーカスインジケーターを明確にする。
*   **UX3: レスポンシブデザイン:**
    *   デスクトップ、タブレット、モバイルの各画面サイズで最適化されたレイアウトと操作性を提供する。コンテンツの優先順位を考慮した配置。

## 6. 非機能要件

*   **NF1: パフォーマンス:** 選択肢の変更に対するフィルタリング、計算処理、UIの応答は100ms以内を目指す。
*   **NF2: ブラウザ互換性:** 主要なモダンブラウザ（Chrome, Firefox, Safari, Edgeの最新版）で動作すること。
*   **NF3: レスポンシブ:** 上記UI/UX要件参照。
*   **NF4: アクセシビリティ:** 上記UI/UX要件参照。
*   **NF5: モジュール性 (Agentアーキテクチャ):** 各Agentは独立して開発・テストが可能であること。
*   **NF6: 保守性 (Agentアーキテクチャ):** 機能ごとの関心事が分離されているため、修正や変更が局所的に行えること。
*   **NF7: テスト容易性 (Agentアーキテクチャ):** 各Agentのロジックを単体テストしやすくする。UI部分はコンポーネントテストを実施。
*   **NF8: 拡張性 (Agentアーキテクチャ):** 新しい計算ロジックや関連機能を新規Agentとして追加しやすい構造であること。

## 7. 将来的な拡張（Agentアーキテクチャの利点を活かす）

*   **減価償却費シミュレーションAgent:** 計算された耐用年数を基に、減価償却費の概算をシミュレーションする機能。
*   **法改正対応Agent:** 耐用年数や計算ロジックの変更があった場合に、影響範囲を特定しやすく、該当Agentの更新で対応。
*   **データ永続化Agent:** 入力内容や計算結果をローカルストレージやサーバーサイドに保存・読み込みする機能。
*   **ユーザー設定Agent:** ダークモード設定、表示オプションなどをユーザーごとに保存する機能。
*   **外部連携Agent:** 不動産情報APIなど外部サービスと連携し、物件情報を自動入力する機能。